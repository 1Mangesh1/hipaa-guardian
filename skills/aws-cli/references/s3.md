# AWS S3 Reference

## Bucket Management

```bash
# Create bucket
aws s3 mb s3://my-bucket --region us-east-1

# List buckets
aws s3 ls

# Bucket policy
aws s3api put-bucket-policy --bucket my-bucket --policy file://policy.json

# Enable versioning
aws s3api put-bucket-versioning --bucket my-bucket \
  --versioning-configuration Status=Enabled

# Enable encryption
aws s3api put-bucket-encryption --bucket my-bucket \
  --server-side-encryption-configuration '{
    "Rules": [{"ApplyServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]
  }'

# Block public access
aws s3api put-public-access-block --bucket my-bucket \
  --public-access-block-configuration \
  BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true
```

## File Operations

```bash
# Upload with metadata
aws s3 cp file.html s3://bucket/ --content-type "text/html" --cache-control "max-age=86400"

# Upload with encryption
aws s3 cp file.txt s3://bucket/ --sse AES256

# Download specific version
aws s3api get-object --bucket my-bucket --key file.txt --version-id "abc123" file.txt

# Multipart upload (automatic for large files)
aws s3 cp large-file.zip s3://bucket/ --expected-size 5368709120

# Recursive copy with filters
aws s3 cp ./build s3://bucket/ --recursive \
  --exclude "*.map" \
  --include "*.js" --include "*.css" --include "*.html"
```

## Static Website Hosting

```bash
# Enable website hosting
aws s3 website s3://my-site \
  --index-document index.html \
  --error-document error.html

# Deploy static site
aws s3 sync ./dist s3://my-site \
  --delete \
  --cache-control "max-age=31536000" \
  --exclude "index.html"

aws s3 cp ./dist/index.html s3://my-site/ \
  --cache-control "no-cache"
```

## Lifecycle Rules

```bash
# Move to Glacier after 90 days, delete after 365
aws s3api put-bucket-lifecycle-configuration --bucket my-bucket \
  --lifecycle-configuration '{
    "Rules": [{
      "ID": "archive-old",
      "Status": "Enabled",
      "Filter": {"Prefix": "logs/"},
      "Transitions": [{"Days": 90, "StorageClass": "GLACIER"}],
      "Expiration": {"Days": 365}
    }]
  }'
```

## CORS Configuration

```bash
aws s3api put-bucket-cors --bucket my-bucket --cors-configuration '{
  "CORSRules": [{
    "AllowedOrigins": ["https://example.com"],
    "AllowedMethods": ["GET", "PUT"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3600
  }]
}'
```
